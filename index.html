<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LENIA TERMINAL</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/crt-effects.css">
    <link rel="stylesheet" href="css/terminal-theme.css">
    <link rel="stylesheet" href="css/audio-panel.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Inline critical styles */
        body {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        body.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div id="boot-screen" class="boot-screen">
        <div class="boot-text"></div>
    </div>

    <!-- Main Application -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-title crt-text">LENIA TERMINAL</h1>
            <nav class="mode-buttons">
                <button class="mode-btn active" data-mode="sandbox">SANDBOX</button>
                <button class="mode-btn" data-mode="challenge">CHALLENGE</button>
                <button class="mode-btn" data-mode="laboratory">LABORATORY</button>
            </nav>
            <div class="settings-panel">
                <label>
                    Theme:
                    <select id="theme-selector">
                        <option value="green">Green</option>
                        <option value="amber">Amber</option>
                        <option value="blue">Blue</option>
                        <option value="white">White</option>
                        <option value="rainbow">ðŸŒˆ Rainbow</option>
                        <option value="fire">ðŸ”¥ Fire</option>
                        <option value="ocean">ðŸŒŠ Ocean</option>
                        <option value="neon">ðŸ’œ Neon</option>
                    </select>
                </label>
                <label>
                    <select id="resolution-selector">
                        <option value="128">128px</option>
                        <option value="256">256px</option>
                    </select>
                </label>
                <label>
                    <input type="checkbox" id="multichannel-toggle">
                    RGB
                </label>
                <label>
                    <input type="checkbox" id="crt-toggle" checked>
                    CRT
                </label>
                <button id="help-btn" class="help-btn">?</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Canvas Area -->
            <div class="canvas-container crt-frame">
                <canvas id="simulation-canvas" width="512" height="512"></canvas>
                <canvas id="overlay-canvas" width="512" height="512"></canvas>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Sandbox Panels -->
                <div class="mode-panel" data-mode="sandbox">
                    <div id="parameter-panel"></div>
                    <div id="preset-panel"></div>
                    <div id="audio-panel"></div>
                </div>

                <!-- Challenge Panels -->
                <div class="mode-panel hidden" data-mode="challenge">
                    <div class="panel">
                        <div class="panel-header">
                            <span class="terminal-prompt">&gt;</span> CHALLENGES
                        </div>
                        <div id="challenge-list" class="challenge-list"></div>
                        <div id="challenge-details" class="challenge-details"></div>
                    </div>
                </div>

                <!-- Laboratory Panels -->
                <div class="mode-panel hidden" data-mode="laboratory">
                    <div id="lab-stats" class="panel"></div>
                    <div class="panel">
                        <div class="panel-header">
                            <span class="terminal-prompt">&gt;</span> EXPERIMENTS
                        </div>
                        <div class="experiment-controls">
                            <button class="retro-button" id="run-sweep-btn">Parameter Sweep</button>
                            <button class="retro-button" id="export-results-btn">Export Results</button>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Footer Controls -->
        <footer class="app-footer">
            <!-- Share Panel -->
            <div id="share-panel"></div>

            <!-- Toolbar -->
            <div id="toolbar" class="toolbar"></div>

            <!-- Playback Controls -->
            <div id="playback-controls" class="playback-controls"></div>

            <!-- Status Bar -->
            <div id="status-bar" class="status-bar">
                <span class="status-mode">[SANDBOX]</span>
                <span class="status-state">Ready</span>
                <span class="status-divider">|</span>
                <span class="status-steps">Steps: 0</span>
                <span class="status-divider">|</span>
                <span class="status-mass">Mass: 0</span>
                <span class="status-divider">|</span>
                <span class="status-fps">0 FPS</span>
            </div>
        </footer>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="crt-text">HELP</h2>
                <button class="modal-close" onclick="document.getElementById('help-modal').classList.remove('visible')">&times;</button>
            </div>
            <div class="modal-body">
                <h3>What is Lenia?</h3>
                <p>Lenia is a continuous cellular automaton - a mathematical model of artificial life where smooth, lifelike creatures emerge from simple rules.</p>

                <h3>Controls</h3>
                <ul>
                    <li><strong>SPACE</strong> - Play/Pause</li>
                    <li><strong>.</strong> - Single step</li>
                    <li><strong>R</strong> - Reset with random pattern</li>
                    <li><strong>C</strong> - Clear canvas</li>
                    <li><strong>1/2/3</strong> - Switch modes</li>
                    <li><strong>Ctrl+S</strong> - Save configuration</li>
                </ul>

                <h3>Parameters</h3>
                <ul>
                    <li><strong>R</strong> - Kernel radius (neighborhood size)</li>
                    <li><strong>Î¼ (mu)</strong> - Optimal density for growth</li>
                    <li><strong>Ïƒ (sigma)</strong> - Tolerance around optimal density</li>
                    <li><strong>dt</strong> - Time step size</li>
                </ul>

                <h3>Tools</h3>
                <ul>
                    <li><strong>Brush</strong> - Draw living cells</li>
                    <li><strong>Eraser</strong> - Remove cells</li>
                    <li><strong>Place</strong> - Place preset creatures</li>
                </ul>

                <h3>Audio</h3>
                <ul>
                    <li><strong>Warmth</strong> - Low-pass filter cutoff</li>
                    <li><strong>Reverb</strong> - Ambient space amount</li>
                    <li><strong>Drift</strong> - Pitch wandering intensity</li>
                    <li><strong>Volume</strong> - Master volume</li>
                </ul>
                <p>The audio generates ambient music based on organism behavior: position affects pitch, mass affects brightness, velocity affects rhythm.</p>

                <h3>Sharing</h3>
                <p>Click ðŸ”— SHARE to copy a compact URL. The seed (ðŸŽ²) determines the initial pattern - same seed = same starting state.</p>

                <h3>Tips</h3>
                <ul>
                    <li>Start with the Orbium preset - it's a stable glider</li>
                    <li>Small changes to Î¼ and Ïƒ can dramatically change behavior</li>
                    <li>Try the Challenge mode to learn step by step</li>
                    <li>Enable audio for an immersive experience!</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/app.js"></script>
    <script>
        // Mark body as loaded when ready
        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
        });
    </script>
</body>
</html>
